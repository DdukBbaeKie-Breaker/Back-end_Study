# 메시지 큐 & 브로커

우리가 웹 서버를 구성하게 된다면 늘 한가지 고민에 빠짐니다.  여러가지가 생각이 들겠지만 가장 중요한건 

__성능__이죠. 많은 양의 데이터, 정보를 처리하게 된면 너무 많은 요청 대기가 쌓이게 됩니다.  그럼 서버의 성능이 

저하되는데 나중에는 뭐 __펑~~__ 터져버리게 됩니다. 그래서 사람들은 많은 생각을 했고 조금더 편리하고 빠른 

처리를 하기 위해 __비동기 메세지 처리 방식__을 구성학게 됩니다.

___

#### 앞서 가기전 용어~

- __메세지 지향 미들웨어(Message Oriented Middleware : MOM)__: 저거 검색해보면 알겠지만 엄청 어렵고 많은 뜻이 올라온다. 쉽게 말하자면 네트워크 상에서 메세지를 전달하는 트럭같은거다. 일반적으로 메시지의 보내기, 받기와 같은 단순한  수행으로 이루어진다.
- __메시지 큐__ : MOM을 구현한 시스템
- __브로커__ : Message Queue 시스템
- __AMQP__ : 메세지 지향 미들웨어를 위한 프로토콜 

일단 메시지 큐를 공부하기 위한 용어는 이 정도만 알고 계시면 될 듯 해요

___

#### 원리~!	

자 용어만 봐도 어마무시 하고 막 하기 싫어지고 그런거 묘한게 올라오져? 저도 알아요... 이게 참 그지 같지만 

알아두면 소켓통신을 할 때 이해가 __빡__ 되는 그런 신기한 기분을 느끼실 수 있을꺼에요.

기본적인 원리를 말하자면 __생산자가 Message를 Queue에 넣어두면 소비자가 Message를 가져와 처리하는 것__

일단 이게 기본적인데 뭔지 모르면 __정상__ 이해가 간다면 조용히 나가시면 될 것 같습니다.

여기서 메시지 큐를 이해하고 싶다! 하고 싶다면 지금부터 집중해라. 

___

__메시지 큐__란 : 시스템이 처리할 일을 차례대로 넣어놓고 시스템이 하나씩 작업을 가져가 처리하고 다음 작업을 또

가져올 수 있는 Store-and-forward 방식의 시스템이다.

여기서 나오는 개념이 바로!! __브로커__이다. 

___

__메시지 브로커__란 : 인터넷 통신에서 메시지 큐는 송신자가 보낸 수신자의 메시지 프로토콜로 변환하는 중간 모듈이

된다.  여기가 중요하다. 만약 송신자가 off가된 나에게 엄청 많은 메시지를 보냈다고 하자. 메시지 큐가 존재하지 

않았다면 난 Time out 에러를 내뿜고 난리가 났을 것이다. 이런 상황처럼 송수신자의 상황을 예측할 수 없기에 

메시지 큐가 필요하다. 송시자와 수신자의 중간다리 역할을 하는게 메시지 브로커이다.

___

이러면 또 다른 의문점이 든다. 송신자가 수신자에게 데이터를 바로 전달해도 성능이 떨어지는 마당에 왜 추가를 

할까??!?!??! 다 상황을 바꿔보자. A라는 서버와 B라는 서버가 존재한다. A는 실시간 데이터를 받는 곳이고 B라는 

서버는 A에서 받은 데이터를 가공하는 서버이다. 그럼 B는 데이터를 받을려면 insert문을 사용하여 DB을 열고 

정보를 찾고 복잡해진다. 하지만 메시지 브로커가 있다면 송신자가 하나하나 보내는 것을 브로커가 A 와 B에게

동시에 보내게 된다. 그럼 DB를 열 필요가 없고 두개의 서버는 동시에 자기가 해야하는 일을 하게 된다. 이런 

상황이 존재하기에 메시지 브로커를 하용하는 것이다.

___

#### 종류

메시지 큐도 몇가지의 종류로 나뉘어 진다. 



__ActiveMQ__ : Java로 만든 오픈 소스 메시지 브로커

- 장점 
  - 다양한 언어 지원
  - STOPM를 통해서도 접근 가능
  - JDBC를 사용하여 매우 빠른 Persitence 지원
  - 클러스터링 가능 등등
- 단점
  - 모니터링 도구 없음



__RabbitMQ__ : AMQP를 지원하는 오픈소스 메시징 시스템

- 장점
  - 실시간 모니터링 및 관리 용이
  - 다양한 언어 지원
  - 클러스터링 가능
- 단점
  - Window OS 시,Erlang, OpenSSL 설치 필요



__Kafka__ : 대용량 실시간 로그 처리에 특화되어 설계된 메시지 시스템

- 장점
  - AMQP나 JMS를 사용하지 않고 단순 메시지 헤더를 지닌 TCP 통신
  - 개별 전송이 아닌 다수 전송 가능
  - 파일 시스템 저장
  - 대기 중인 메시지로 인한 시스템 성능 감소 줄임
  - 분산 시스템이 기본적으로 설계

- 단점
  - 큐의 기능은 기존 JMS나 Broker 보다 부족





자 여기까지 소켓을 할 때 알아두면 진~~~짜 좋은 이론이다. 어렵지만 꼭 외워두길 바란다.
