# 세션과 토큰 그리고 쿠키 

여러분들은 웹,앱 개발을 하면 나오는 개념이 "인증"입니다. 구현하려면 가장 어렵고 이해하기 어려운 개념이라고 생각합니다. 그렇기에 이번 정리를 통해 이해에 조금이나마 도움이 되었으면 좋겠다는 바람입니다.

___

#### 인증을 하는 이유

우리는 왜 인증을 해야 하는가? 대표적인 예시를 들어보겠다. A라는 사람이 있고 B라는 사람이 있습니다. A라는 사람과 B라는 사람이 가지고 있는 정보, 내용이 다릅니다. 그렇기에 구분을 지어주기 위해 인증이라는 것을 한다. 

이것은 대표적인 예시이다. 간단하게 말하자면 앱, 웹을 로그인을 해서 이용할 때 마다 __나__ 라는 것을 알려주는 것이다.

구현하기 쉽겠네라고 생각하는 경우도 있다. 하지만 인증은 생각보다 호락호락하지 않다. 인증방식에는 대표적으로 3가지가 있으며 그중 2가지는 방법이 거의 다르기에 외워야 하는 것도 많다. 이번 정리는 세션, 토큰, 쿠키에 대해 정리하도록 하겠다.

___

#### 잠깐!!

지난번에 설명한 HTTP는 개념적으로만 이야기를 했었다. 이번에는 HTTP 프로토콜의 특징 2개를 알고 넘어가자.

- __Connectionless(비연결지향)__ : 클라이언트와 서버가 요청과 응답을 한 번 주고 받으면 연결을 끊어버리는 특징을 말한다.클라이언트가 request를 서버로 보내면 서버는 클라이언트가 보낸 request에 맞게 response를 보내고 연결을 끊는다.
- __Stateless(상태정보유지안함)__ : 위처럼 요청과 응답으로 틍신이 끝난다면 상태정보를 유지하지 않는 특징이다.
  - 예를 들어 메인페이지에서 로그인을 하고 다른 페이지로 넘어가면 다시 로그인을 해야한다.



이런 특징들 때문에 __쿠키__ __세션__ __토큰(JWT)__ 를 이용하여 HTTP의 문제를 해결한다.

___

#### 쿠키

쿠키는 __클라이언트__ 에 저장되는 Key와 Value로 이루어진 작은 데이터 파일이다. 인증 유효 시간을 설정 할 수 있고 유효 시간이 정해진다면 클라이언트가 종료가 되어도 인증이 유지가 된다는 특징이 있다.

- __쿠키 구성 요소__
  - __이름__
    - 각각의 쿠키를 구별하는 데 사용되는 이름
  - __값__
    - 쿠키가 갖고 있는 값
  - __유효시간__
    - 쿠키의 유지시간
  - __도메인__
    - 쿠키를 전송할 도메인
  - __경로__
    - 쿠키를 전송할 경로



- __동작 방식__
  - 1. 클라이언트가 로그인 요청
    2. 서버에서 쿠키 생성 후 클라이언트로 전달
    3. 클라이언트가 서버로 요청을 보낼 때 쿠키를 전송
    4. 쿠키를 이용해 유저 인증을 진행

그러나 문제점으로 사용자 인증에 대한 정보를 모두 클라이언트가 가지고 있게되므로 http 요청을 탈취 당할 경우 쿠키 자체를 탈취당해 사용자의 정보를 빼앗게 될 수도 있다. 그렇기에 쿠키자체는 보안과는 큰 상관이 없는 자동로그인 같은 설정 등에 이용할 수 있다.

___

#### 세션

세션은 쿠키와 매우 흡사하다. 하지만 몇가지의 차이점이 있다면 쿠키는 __클라이언트__ 에 저장을 헀다면 세션은 __서버__ 가 저장을 한다. 서버에서는 클라이언트를 구분하기 위해 __세션ID__ 를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료 할 때까지 인증상태를 유지합니다. 물론 유효시간을 설정하여 일정시간 동작이 없다면 세션을 끊도록 설정도 가능합니다.

- __동작 방식__
  - 클라이언트가 로그인 요청
  - 서버에서는 클라이언트에게 고유한 세션ID를 부여하고 세션 저장소에 저장한 후 클라이언트에게 발급한다.
  - 클라이언트는 세션ID에 대해 쿠키를 사용해서 저장(이때 쿠키의 이름은 JSESSIONID이다.)
  - 클라이언트가 서버에 다시 접속 시 이 쿠키를 이용하여 세션ID 값을 전달

___

#### 잠깐!!!! 2

쿠키와 세션은 비슷한 역할을 하며 심지어 동작 원리 조차 비슷합니다.

그이유는 세션도 결국 쿠키를 사용하기 때문입니다.

다만 위에서 말했 듯이 가장 큰 차이점은 __기록이 저장되는 위치__ 입니다. 때문에 쿠크는 서버의 자원을 사용하지 않지만 세션은 서버의 자원을 사용합니다.

또한 보안면에서는 세션이 우수한데  속도면에서는 쿠키가 세션보다 빠릅니다. 이유는 세션은 처버에서 처리가 필요하기 때문입니다.

___

#### 토큰(JWT)

대망의 토큰입니다. 쿠키는 클라이언트가 사용자의 정보를 가지고 있어  보안이 취악하고 세션은 서버의 메모리를 차지하기 때문에 느려지고 중간에 __세션 하이재킹__ 을 당할 수 도 있습니다. 그래서 이 둘을 보안하기 위해 나온 개념이 토큰입니다.

JWT -> Json Web Token의 약자이고 인증에 필요한 정보들을 __암호화__시킨 토큰을 말합니다. 자세하게 알아보기 전에 동작 방식부터 설명하겠습니다.

- __동작 방식__
  - JSON 객체에 요구사항을 작성
  - 어떠한 암호화 방식을 사용해서 문자열 인코딩
  - HTTP header에 추가함으로써 사용자 인증을 요청
  - 서버에서는 Header에 추가된 Token을 디코딩하여 사용자를 인증합니다.



__JWT의 생김새__

JWT는 __.__ 를 구분으로 3가지의 문자열로 되어있습니다. 구조는 다음과 같이 이루어져 있습니다.

- aaaaaa.bbbbbb.cccccc 
  - a = 헤더, b = 내용, c = 서명
    - __헤더__ : 토큰의 타입을 지정합니다.
    - __내용__ : 토큰의 담을 정보가 들어있습니다.
    - __서명__ : 인코딩값 입니다. 인코딩을 할때 비밀키를 지정하여 비밀키의 값으로 해쉬를 합니다.



__JWT의 정리__

- JWT는 그 자체가 암호화된 문자열 데이터입니다.
- 토큰은 HTTP header에 추가되기 때문에 서버에 따로 보관할 필요가 없으므로 서버에 부화를 일으키지 않습니다.
- 토큰을 생성할 때 암호화 과정을 거치므로 보안적으로 안전합니다.





토큰에는 Refresh Token, Access Token이 존재하는데 토큰에 대해서는 설명할 것이 많기 때문에 따로 공부해보시는 것을 추천합니다.

___

#### 결론

쿠키와 세션과 토큰의 장단점을 설명하고 마무리 하겠습니다.



- __쿠키__
  - __장점__ : 서버 공간 절약
  - __단점__ : 보안 취약, 쿠키 용량 제한, 브라우저 공유 불가능, 쿠키의 사이즈가 커질수록 네트워크 부하
- __세션__
  - __장점__ : 쿠키보다 보안 향상, 용량 제한 x, 브라우저 의존도 낮음, 네트워크 부하 낮음
  - __단점__ : 서버 부하
- __토큰(JWT)__
  - __장점__ : 쿠키장점 + 세션 장점, Pc와 모바일 공유 가능
  - __단점__ : 토큰 길이가 늘어날수록 네트워크 부하

JWT는 간단하게 정리를 했기 때문에 따로 더 찾아서 공부하시는 것을 추천합니다. 

이상 부족하고 긴 글을 읽어주셔서 감사합니다.